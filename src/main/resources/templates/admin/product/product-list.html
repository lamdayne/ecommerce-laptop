<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>List Product</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div class="container">
    <ul class="nav nav-pills nav-justified">
        <li class="nav-item">
            <a class="nav-link" aria-current="page" href="/admin/index">Home</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/admin/product">Product</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="/admin/list-product">List Product</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Category</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Brand</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">User</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Order</a>
        </li>
    </ul>
    <div class="row">
        <table class="table table-bordered">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Thumbnail</th>
                <th scope="col">Name</th>
                <th scope="col">Base Price</th>
                <th scope="col">Sale Price</th>
                <th scope="col">Action</th>
            </tr>
            </thead>
            <tbody>
            <th:block th:each="product, status : ${products}">
                <tr>
                    <th scope="row" th:text="${status.count}"></th>
                    <td>
                        <img class="rounded" th:src="${product.thumbnail}" width="160px">
                    </td>
                    <td class="fw-medium" th:text="${product.name}"></td>
                    <td th:text="${#numbers.formatDecimal(product.basePrice, 0, 'POINT', 0, 'COMMA')} + ' đ'"></td>
                    <td th:text="${#numbers.formatDecimal(product.salePrice, 0, 'POINT', 0, 'COMMA')} + ' đ'"></td>
                    <td>
                        <a th:href="@{|/admin/product/${product.id}|}" class="btn btn-warning">Edit</a>
                        <button th:data-id="${product.id}" class="btn btn-danger btn-delete">Delete</button>
                    </td>
                </tr>
            </th:block>
            </tbody>
        </table>
    </div>
</div>

<script>
    document.querySelectorAll(".btn-delete").forEach(btn => {
        btn.addEventListener("click", (e) => {
            const productId = e.currentTarget.getAttribute('data-id');
            Swal.fire({
                title: "Bạn có muốn xóa sản phẩm này?",
                text: "Khi xóa sản phẩm sẽ không tồn tại",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Delete"
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/products/${productId}`, { method: "DELETE" })
                        .then(res => res.json())
                        .then(result => {
                            Swal.fire({
                                title: "Deleted!",
                                text: result.message,
                                icon: "success"
                            });
                            window.location.href = "/admin/list-product";
                        })
                }
            });
        })
    })
</script>
</body>
</html>