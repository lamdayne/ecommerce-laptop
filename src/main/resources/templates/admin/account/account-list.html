<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Account Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div th:replace="~{admin/navbar-admin}"></div>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Quản lý người dùng</h3>
  </div>

  <table class="table table-bordered table-hover">
    <thead class="table-light text-center">
    <tr>
      <th>ID</th>
      <th>Họ và tên</th>
      <th>Email</th>
      <th>Số điện thoại</th>
      <th>Quyền hạn</th>
      <th>Hành động</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="u : ${page.content}">
      <td th:text="${u.id}" class="small text-muted"></td>
      <td th:text="${u.fullName}" class="fw-bold"></td>
      <td th:text="${u.email}"></td>
      <td th:text="${u.phone}"></td>
      <td class="text-center">
        <span th:if="${u.role}" class="badge bg-danger">ADMIN</span>
        <span th:unless="${u.role}" class="badge bg-primary">USER</span>
      </td>
      <td class="text-center">
        <a th:href="@{|/admin/account/${u.id}|}" class="btn btn-warning btn-sm">Sửa</a>
        <button th:onclick="'confirmDelete(\'' + ${u.id} + '\')'" class="btn btn-danger btn-sm">Xóa</button>
      </td>
    </tr>
    </tbody>
  </table>

  <nav th:if="${page.totalPages > 1}">
    <ul class="pagination justify-content-center">
      <li class="page-item" th:classappend="${page.first} ? 'disabled'">
        <a class="page-link" th:href="@{/admin/account/list(page=${page.number})}">Previous</a>
      </li>
      <li class="page-item" th:each="i : ${#numbers.sequence(1, page.totalPages)}"
          th:classappend="${i == page.number + 1} ? 'active'">
        <a class="page-link" th:href="@{/admin/account/list(page=${i})}" th:text="${i}"></a>
      </li>
      <li class="page-item" th:classappend="${page.last} ? 'disabled'">
        <a class="page-link" th:href="@{/admin/account/list(page=${page.number + 2})}">Next</a>
      </li>
    </ul>
  </nav>
</div>

<script>
  function confirmDelete(id) {
    Swal.fire({
      title: "Xác nhận xóa tài khoản?",
      text: "Dữ liệu người dùng sẽ bị xóa vĩnh viễn!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#d33",
      confirmButtonText: "Xóa"
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = "/admin/account/delete/" + id;
      }
    });
  }
</script>
<script th:if="${message}">
  Swal.fire("Thông báo", "[[${message}]]", "success");
</script>
</body>
</html>