<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Category List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div th:replace="~{admin/navbar-admin}"></div>
<div class="container mt-4">
  <div class="d-flex justify-content-between mb-3">
    <h3>Danh sách loại hàng</h3>
    <a href="/admin/category" class="btn btn-primary">Thêm loại mới</a>
  </div>

  <table class="table table-bordered table-hover">
    <thead class="table-light">
    <tr>
      <th>ID</th>
      <th>Tên loại hàng</th>
      <th>Hành động</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="cat, status : ${page.content}">
      <td th:text="${cat.id}"></td>
      <td class="fw-bold" th:text="${cat.name}"></td>
      <td>
        <a th:href="@{|/admin/category/${cat.id}|}" class="btn btn-warning btn-sm">Sửa</a>
        <button th:onclick="'deleteCategory(' + ${cat.id} + ')'" class="btn btn-danger btn-sm">Xóa</button>
      </td>
    </tr>
    </tbody>
  </table>

  <nav th:if="${page.totalPages > 1}">
    <ul class="pagination justify-content-center">
      <li class="page-item" th:classappend="${page.first} ? 'disabled'">
        <a class="page-link" th:href="@{/admin/category/list(page=${page.number})}">Previous</a>
      </li>
      <li class="page-item" th:each="i : ${#numbers.sequence(1, page.totalPages)}"
          th:classappend="${i == page.number + 1} ? 'active'">
        <a class="page-link" th:href="@{/admin/category/list(page=${i})}" th:text="${i}"></a>
      </li>
      <li class="page-item" th:classappend="${page.last} ? 'disabled'">
        <a class="page-link" th:href="@{/admin/category/list(page=${page.number + 2})}">Next</a>
      </li>
    </ul>
  </nav>
</div>

<script>
  function deleteCategory(id) {
    Swal.fire({
      title: "Xác nhận xóa?",
      text: "Dữ liệu sẽ không thể khôi phục!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Xóa ngay"
    }).then((result) => {
      if (result.isConfirmed) {
        fetch(`/categories/${id}`, { method: 'DELETE' })
                .then(() => window.location.reload());
      }
    });
  }
</script>
<script th:if="${message}">
  Swal.fire("Thành công", "[[${message}]]", "success");
</script>
</body>
</html>